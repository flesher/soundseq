//
// the track class
//
function Track(e){this.readyFn=[];this.track=CONFIG.TRACKS[e];this.track_id=this.track.track_id;this.file=this.track.file;this.profile={};this.analysis={};this.sections=[];$.ajax({url:"http://developer.echonest.com/api/v4/track/profile",type:"GET",context:this,data:{id:this.track_id,api_key:CONFIG.APIKEY,bucket:"audio_summary",format:"json"},error:function(e,t,n){console.error("WOH THERE!",e,t)},success:function(e,t,n){this.profile=e.response.track;$.ajax({url:this.profile.audio_summary.analysis_url,type:"GET",context:this,error:function(e,t,n){console.error("WOH THERE!",e,t)},success:function(e,t,n){this.analysis=e;this.init();callbacks=this.readyFn;$(function(){for(var e=0;e<callbacks.length;e++)callbacks[e]()})}})}})}Track.prototype.init=function(){analysis=this.analysis;var e=[];_.each(analysis.sections,function(t){if(t.confidence>.5){t.end=t.start+t.duration;t.beats=_.filter(analysis.beats,function(e){e.end=e.start+e.duration;return e.start>=t.start&&e.end<=t.end});e.push(t)}});this.sections=e};Track.prototype.ready=function(e){this.readyFn.push(e)};Track.prototype.artist=function(){return this.profile.artist};Track.prototype.duration=function(){return this.profile.duration};Track.prototype.tempo=function(){return this.profile.audio_summary.tempo};Track.prototype.section=function(e){return this.sections[e]};Track.prototype.beat=function(e,t){var n=this.sections[e].beats[t];return[n.start*1e3,n.duration*1e3]};